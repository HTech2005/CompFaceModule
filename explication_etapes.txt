# Explication Technique des Processus CDV et TR

Ce document détaille les étapes algorithmiques, les formules mathématiques et les justifications techniques pour les deux fonctionnalités principales du module : **CDV** (Comparaison de Visages) et **TR** (Temps Réel / Reconnaissance).

## 1. CDV : Comparaison de Visages (Mode 1 contre 1)
Ce mode permet de vérifier si deux photos appartiennent à la même personne.

### Étapes du processus :
1. **Chargement des images** : L'utilisateur sélectionne deux fichiers images.
2. **Détection de Visage (FaceDetection)** :
   - L'image est convertie en niveaux de gris.
   - **CLAHE** (Contrast Limited Adaptive Histogram Equalization) est appliqué pour normaliser l'éclairage.
   - L'algorithme **Haar Cascade** détecte les zones de visages.
   - On sélectionne le visage le plus grand et on effectue un recadrage (crop) avec une marge interne de 15% pour éliminer le fond inutile.
3. **Prétraitement (Pretraitement.pt)** :
   - Redimensionnement à 128x128 pixels (standardisation).
   - Flou Gaussien (sigma=0.8) pour réduire le bruit numérique (le "grain" de l'image).
   - Nouvelle passe de CLAHE pour accentuer les traits (yeux, bouche, nez).
4. **Extraction de Caractéristiques (Feature Extraction)** :
   - **Histogramme (H)** : Analyse la distribution des niveaux de gris (luminosité) sur une grille 8x8.
   - **LBP (Local Binary Patterns)** : Analyse la texture fine (la peau, les rides) sur une grille 8x8.
   - **Fusion** : Concaténation des vecteurs H et LBP.
   - **Normalisation** : Le vecteur final est normalisé pour que sa longueur soit égale à 1 (indispensable pour le calcul Cosinus).
5. **Calcul de Ressemblance** : Les deux vecteurs sont comparés utilisant 3 formules de distance (voir section Formules).
6. **Décision** : Un score global pondéré est calculé. Si > 70%, c'est un match.

---

## 2. TR : Reconnaissance Temps Réel (Mode 1 contre N)
Ce mode identifie une personne en direct via la webcam en la comparant à toute la base de données.

### Étapes du processus :
1. **Acquisition Vidéo** : Capture du flux webcam (30 images/seconde).
2. **Boucle d'Analyse** : Toutes les ~1 seconde, une image est traité.
3. **Ciblage** : On découpe une zone centrale (Recadrage 200x240) pour forcer l'utilisateur à bien se positionner.
4. **Détection** : Mêmes étapes que pour le CDV (Gris + CLAHE + Haar).
5. **Extraction** : Le visage détecté subit le même Prétraitement et Extraction de Caractéristiques que le CDV.
6. **Recherche en Base (1:N)** :
   - Le vecteur du visage webcam est comparé à **tous** les vecteurs pré-calculés de la base de données (`src/main/bdd`).
   - Pour chaque personne en base, un score de compatibilité est calculé.
7. **Filtrage** : On garde le candidat ayant le meilleur score.
8. **Validation** :
   - Si le meilleur score > 70% : **Identité confirmée**.
   - Sinon : **Inconnu**.

---

## 3. Formules et Justifications

Pourquoi utiliser 3 distances différentes ? C'est la méthode de la "Triple Expertise" pour rendre le système robuste.

### A. Distance Chi-Carré (Chi-Square)
Utilisée pour comparer les histogrammes (textures).
- **Formule** : $\chi^2(A,B) = \sum \frac{(A_i - B_i)^2}{A_i + B_i}$
- **Pourquoi ?** : Très sensible aux variations de distribution. Si les textures de peau sont différentes, cette distance augmente rapidement. C'est l'expert en "Texture".

### B. Similitude Cosinus
Utilisée pour comparer l'orientation des vecteurs.
- **Formule** : $Cos(\theta) = \frac{A \cdot B}{\|A\| \|B\|}$
- **Pourquoi ?** : Insensible à l'intensité globale (e.g., une photo plus sombre qu'une autre). Elle mesure si les traits pointent dans la même "direction" mathématique. C'est l'expert en "Structure".

### C. Distance Euclidienne
La distance géométrique classique.
- **Formule** : $d(A,B) = \sqrt{\sum (A_i - B_i)^2}$
- **Pourquoi ?** : Mesure l'écart global brut. C'est l'expert "Généraliste".

---

## 4. Score Global (La Fusion)
Pour prendre la décision finale, le code combine ces trois avis :

$$ScoreGlobal = (ScoreChi2 \times 0.6) + (ScoreCosinus \times 0.2) + (ScoreEuclidien \times 0.2)$$

**Pourquoi ces poids ?**
- **60% pour Chi2** : La texture (LBP/Histogramme) est l'information la plus fiable en reconnaissance faciale par caractéristiques locales.
- **20% pour Cosinus** : Aide à valider la structure.
- **20% pour Euclidien** : Filet de sécurité global.

Si le résultat final dépasse **70%**, le système considère que c'est la même personne.
